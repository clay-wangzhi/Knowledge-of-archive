<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>17 IO 模型 | IT外卖小哥</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="alternate" type="application/atom+xml" href="https://clay-wangzhi.com/atom.xml" title="IT外卖小哥 Atom Feed">
    <link rel="alternate" type="application/json" href="https://clay-wangzhi.com/feed.json" title="IT外卖小哥 JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://clay-wangzhi.com/rss.xml" title="IT外卖小哥 RSS Feed">
    <link rel="icon" href="/favicon.ico">
    <link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192">
    <link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png">
    <meta name="description" content="当你发现自己的才华撑不起野心时，就请安静下来学习吧！">
    <meta property="og:url" content="/code/python/python-io-model.html">
    <meta property="og:site_name" content="IT外卖小哥">
    <meta property="og:title" content="17 IO 模型">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="IT外卖小哥">
    <meta property="article:author" content="Clay">
    <meta name="theme-color" content="#46bd87">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/assets/css/0.styles.ca69d379.css" as="style"><link rel="preload" href="/assets/js/app.8a92dcc3.js" as="script"><link rel="preload" href="/assets/js/layout-Layout.3b564286.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.25725a2a.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.cf79f7df.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout.cbd798c5.js" as="script"><link rel="preload" href="/assets/js/page-17IO模型.519ac500.js" as="script"><link rel="prefetch" href="/assets/js/320.bef365d0.js"><link rel="prefetch" href="/assets/js/321.f35c9d29.js"><link rel="prefetch" href="/assets/js/322.a29ba1a1.js"><link rel="prefetch" href="/assets/js/323.cc39ce2c.js"><link rel="prefetch" href="/assets/js/324.f63d5169.js"><link rel="prefetch" href="/assets/js/layout-Blog.5354c823.js"><link rel="prefetch" href="/assets/js/layout-NotFound.44ee922f.js"><link rel="prefetch" href="/assets/js/layout-Slide.1b84b1ce.js"><link rel="prefetch" href="/assets/js/page--00e7df1c.86b285c3.js"><link rel="prefetch" href="/assets/js/page--0585b5dc.92418997.js"><link rel="prefetch" href="/assets/js/page--0a7aecb9.7c5800bf.js"><link rel="prefetch" href="/assets/js/page--0cab49f5.e4beed51.js"><link rel="prefetch" href="/assets/js/page--15976610.3556c67d.js"><link rel="prefetch" href="/assets/js/page--19ea0457.d26d2aa6.js"><link rel="prefetch" href="/assets/js/page--1e867335.effa26da.js"><link rel="prefetch" href="/assets/js/page--26349a62.9fb2a344.js"><link rel="prefetch" href="/assets/js/page--2662697e.35d08732.js"><link rel="prefetch" href="/assets/js/page--2ce6c413.9ec73a22.js"><link rel="prefetch" href="/assets/js/page--2d434a77.100ac365.js"><link rel="prefetch" href="/assets/js/page--3917fb31.59968f83.js"><link rel="prefetch" href="/assets/js/page--40ad438d.dbbf4074.js"><link rel="prefetch" href="/assets/js/page--42da580f.7ef85d6c.js"><link rel="prefetch" href="/assets/js/page--44a2687f.39a1e08a.js"><link rel="prefetch" href="/assets/js/page--5c23cf26.e249decb.js"><link rel="prefetch" href="/assets/js/page--6d547f66.eb44ffa0.js"><link rel="prefetch" href="/assets/js/page--79708478.72df4a6e.js"><link rel="prefetch" href="/assets/js/page--7c7856ad.08d4d3ae.js"><link rel="prefetch" href="/assets/js/page--86e5ca40.7896518c.js"><link rel="prefetch" href="/assets/js/page--924b4be6.0b7def10.js"><link rel="prefetch" href="/assets/js/page--a2e3c926.821df156.js"><link rel="prefetch" href="/assets/js/page--ab85f1a6.7b4e8e34.js"><link rel="prefetch" href="/assets/js/page--be63dd2e.b2148af5.js"><link rel="prefetch" href="/assets/js/page--c26e6710.6b4dbb1b.js"><link rel="prefetch" href="/assets/js/page--c4128808.94cda38c.js"><link rel="prefetch" href="/assets/js/page--cfea16a6.acb71a6d.js"><link rel="prefetch" href="/assets/js/page--de2eec66.2975fce3.js"><link rel="prefetch" href="/assets/js/page--e5093032.f3390ad3.js"><link rel="prefetch" href="/assets/js/page--f7d54b0e.4b407467.js"><link rel="prefetch" href="/assets/js/page-01Python基础语法.444b5537.js"><link rel="prefetch" href="/assets/js/page-02线性数据结构.12734f07.js"><link rel="prefetch" href="/assets/js/page-03哈希表和解析式.1b96f95c.js"><link rel="prefetch" href="/assets/js/page-04函数.189d68a6.js"><link rel="prefetch" href="/assets/js/page-05装饰器.e43a5c58.js"><link rel="prefetch" href="/assets/js/page-06目录文件处理.d0ac1f21.js"><link rel="prefetch" href="/assets/js/page-07序列化和反序列化.2df988d5.js"><link rel="prefetch" href="/assets/js/page-08异常处理.46d3502a.js"><link rel="prefetch" href="/assets/js/page-09面向对象-封装.479a60e1.js"><link rel="prefetch" href="/assets/js/page-1011使用awk处理字符串.30bef6c9.js"><link rel="prefetch" href="/assets/js/page-1012参考资料.2d51dea1.js"><link rel="prefetch" href="/assets/js/page-101字符串处理.7781721f.js"><link rel="prefetch" href="/assets/js/page-102参数替换.48c2fa1c.js"><link rel="prefetch" href="/assets/js/page-10Todolist.8533e571.js"><link rel="prefetch" href="/assets/js/page-10继承多态和Mixin.0236fad7.js"><link rel="prefetch" href="/assets/js/page-10读写分离和Amoeba.871c02f0.js"><link rel="prefetch" href="/assets/js/page-111循环.e6dd6ebc.js"><link rel="prefetch" href="/assets/js/page-112嵌套循环.4e9ffd9e.js"><link rel="prefetch" href="/assets/js/page-113循环控制.c9262c59.js"><link rel="prefetch" href="/assets/js/page-114测试与分支.0da65522.js"><link rel="prefetch" href="/assets/js/page-11MySQL逻辑架构.067f46e5.js"><link rel="prefetch" href="/assets/js/page-11魔术方法.fdb63e09.js"><link rel="prefetch" href="/assets/js/page-12MySQL锁等待.9f25b91e.js"><link rel="prefetch" href="/assets/js/page-12线程.19a06ffb.js"><link rel="prefetch" href="/assets/js/page-13MySQL常见问题.ee67e315.js"><link rel="prefetch" href="/assets/js/page-13线程同步.d6e9b3f3.js"><link rel="prefetch" href="/assets/js/page-14MySQLbin-log日志清理.d1cc77d4.js"><link rel="prefetch" href="/assets/js/page-14多进程.93f7ed19.js"><link rel="prefetch" href="/assets/js/page-15TCP编程.f5ff9fde.js"><link rel="prefetch" href="/assets/js/page-16SocketServer.929c157d.js"><link rel="prefetch" href="/assets/js/page-181正则表达式简介.8383dfe3.js"><link rel="prefetch" href="/assets/js/page-182文件名替换.f9d56d71.js"><link rel="prefetch" href="/assets/js/page-183正则表达式对照表.c4896737.js"><link rel="prefetch" href="/assets/js/page-18正则表达式.3e034780.js"><link rel="prefetch" href="/assets/js/page-19嵌入文档.7a07915d.js"><link rel="prefetch" href="/assets/js/page-1MySQL基本操作.6865cb46.js"><link rel="prefetch" href="/assets/js/page-1zabbix44新功能.90d05737.js"><link rel="prefetch" href="/assets/js/page-1初识Ansible.a74d15aa.js"><link rel="prefetch" href="/assets/js/page-1初识Nginx.3e13bfc4.js"><link rel="prefetch" href="/assets/js/page-201使用exec.80e43fbd.js"><link rel="prefetch" href="/assets/js/page-202重定向代码块.d4c3c607.js"><link rel="prefetch" href="/assets/js/page-203应用程序.d1aeb10f.js"><link rel="prefetch" href="/assets/js/page-20IO重定向.f31e0f96.js"><link rel="prefetch" href="/assets/js/page-21调用一个脚本.aad22a6f.js"><link rel="prefetch" href="/assets/js/page-22牛刀小试.aa3da677.js"><link rel="prefetch" href="/assets/js/page-241复杂函数和函数复杂性.0ba9ae0e.js"><link rel="prefetch" href="/assets/js/page-242局部变量.3bf81a11.js"><link rel="prefetch" href="/assets/js/page-243不使用局部变量的递归.8bac692f.js"><link rel="prefetch" href="/assets/js/page-24函数.b982eeca.js"><link rel="prefetch" href="/assets/js/page-25别名.8b411ba8.js"><link rel="prefetch" href="/assets/js/page-27数组.3d6b2d20.js"><link rel="prefetch" href="/assets/js/page-2AnsibleInventory配置详解.022d685d.js"><link rel="prefetch" href="/assets/js/page-2nginx架构基础.9e44813d.js"><link rel="prefetch" href="/assets/js/page-2zabbix借助ansible安装.4917627a.js"><link rel="prefetch" href="/assets/js/page-2列表类型和数据完整性.5bd43081.js"><link rel="prefetch" href="/assets/js/page-30网络编程.c2c0f952.js"><link rel="prefetch" href="/assets/js/page-31Ansiblelineinfile模块详解.9ae4b93f.js"><link rel="prefetch" href="/assets/js/page-31nginx全局块和events块配置.a9cbf9a6.js"><link rel="prefetch" href="/assets/js/page-32nginxHTTP块配置.f166ad6a.js"><link rel="prefetch" href="/assets/js/page-32调试.d5c34387.js"><link rel="prefetch" href="/assets/js/page-33nginxSERVER块配置.2e10371d.js"><link rel="prefetch" href="/assets/js/page-33选项.69b262ef.js"><link rel="prefetch" href="/assets/js/page-34nginxLOCATION块配置.724dab32.js"><link rel="prefetch" href="/assets/js/page-35nginx常用模块.d8383870.js"><link rel="prefetch" href="/assets/js/page-361交互和非交互shell以及脚本.85ef90a9.js"><link rel="prefetch" href="/assets/js/page-362shellwrappers.606303c0.js"><link rel="prefetch" href="/assets/js/page-363测试和比较的其他方法.55858718.js"><link rel="prefetch" href="/assets/js/page-364递归：可以调用自己的脚本.5217b02e.js"><link rel="prefetch" href="/assets/js/page-3AnsibleAd-hoc命令集.c4554a3b.js"><link rel="prefetch" href="/assets/js/page-3nginx配置文件详解.7d628b83.js"><link rel="prefetch" href="/assets/js/page-3zabbix添加报警媒介.79330abf.js"><link rel="prefetch" href="/assets/js/page-3数据库设计与查询语句.df33b8ec.js"><link rel="prefetch" href="/assets/js/page-41Playbook的结构及handler用法.6865379d.js"><link rel="prefetch" href="/assets/js/page-41变量替换.84f6be01.js"><link rel="prefetch" href="/assets/js/page-42Playbook循环语句.5ec7dd98.js"><link rel="prefetch" href="/assets/js/page-42变量赋值.469de207.js"><link rel="prefetch" href="/assets/js/page-43Bash变量是弱类型的.a809ace7.js"><link rel="prefetch" href="/assets/js/page-43Playbook条件语句.cdfafd47.js"><link rel="prefetch" href="/assets/js/page-44Playbook高级用法.83944afb.js"><link rel="prefetch" href="/assets/js/page-44特殊的变量类型.282dd720.js"><link rel="prefetch" href="/assets/js/page-45Playbook之tags.be04edf0.js"><link rel="prefetch" href="/assets/js/page-46巧用Roles.bb69563e.js"><link rel="prefetch" href="/assets/js/page-48yaml语法.bf4d1b90.js"><link rel="prefetch" href="/assets/js/page-4AnsiblePlaybook.1585813c.js"><link rel="prefetch" href="/assets/js/page-4MySQL监控模块.f6ae40d8.js"><link rel="prefetch" href="/assets/js/page-4内核参数优化.88e39489.js"><link rel="prefetch" href="/assets/js/page-4视图、事务、索引、函数.6c423898.js"><link rel="prefetch" href="/assets/js/page-51引用变量.50e02e5c.js"><link rel="prefetch" href="/assets/js/page-51自定义变量.67935fbc.js"><link rel="prefetch" href="/assets/js/page-52Fact变量.335558e5.js"><link rel="prefetch" href="/assets/js/page-52转义.d72e6c59.js"><link rel="prefetch" href="/assets/js/page-53魔法变量.0cb33273.js"><link rel="prefetch" href="/assets/js/page-54使用lookup生成变量.43e2fce0.js"><link rel="prefetch" href="/assets/js/page-55使用vault配置加密.b61b6a55.js"><link rel="prefetch" href="/assets/js/page-5Ansible变量.6d56177f.js"><link rel="prefetch" href="/assets/js/page-5MySQL存储引擎.3c2e9329.js"><link rel="prefetch" href="/assets/js/page-5Redis监控模块.62916af4.js"><link rel="prefetch" href="/assets/js/page-5状态码.d6af00c9.js"><link rel="prefetch" href="/assets/js/page-61Nginx出现403forbidden的三种原因.b5641797.js"><link rel="prefetch" href="/assets/js/page-6Ansible使用优化.1d330b90.js"><link rel="prefetch" href="/assets/js/page-6nginx的常见问题.a0047136.js"><link rel="prefetch" href="/assets/js/page-6常见问题.2738a5cd.js"><link rel="prefetch" href="/assets/js/page-6用户权限和访问控制.76e1d7f8.js"><link rel="prefetch" href="/assets/js/page-71测试结构.7c2341e4.js"><link rel="prefetch" href="/assets/js/page-72文件测试操作.10383e01.js"><link rel="prefetch" href="/assets/js/page-73其他比较操作.e0e05cf1.js"><link rel="prefetch" href="/assets/js/page-74嵌套ifthen条件测试.cb12769e.js"><link rel="prefetch" href="/assets/js/page-75牛刀小试.9f0618fb.js"><link rel="prefetch" href="/assets/js/page-7备份恢复.e667c774.js"><link rel="prefetch" href="/assets/js/page-7常见问题.8e5a1c3d.js"><link rel="prefetch" href="/assets/js/page-7用zabbixapi批量添加web监控.fa6a4e83.js"><link rel="prefetch" href="/assets/js/page-81运算符.7eba540e.js"><link rel="prefetch" href="/assets/js/page-82数字常量.dc18bc0a.js"><link rel="prefetch" href="/assets/js/page-8AB复制.12c1fac4.js"><link rel="prefetch" href="/assets/js/page-8activemq监控.fbba0372.js"><link rel="prefetch" href="/assets/js/page-91内部变量.e006fda3.js"><link rel="prefetch" href="/assets/js/page-921declare的另类用法.8cc64d6d.js"><link rel="prefetch" href="/assets/js/page-92变量类型标注：declare与typeset.471dde90.js"><link rel="prefetch" href="/assets/js/page-93$RANDOM：生成随机数.b1eefcd7.js"><link rel="prefetch" href="/assets/js/page-9zookeeper集群监控.ee175ac3.js"><link rel="prefetch" href="/assets/js/page-9主主和keepalived.ee0e77f4.js"><link rel="prefetch" href="/assets/js/page-Ansible学习笔记.aea4b5b3.js"><link rel="prefetch" href="/assets/js/page-Centos76下Elasticseatch72集群搭建步骤.542bf33e.js"><link rel="prefetch" href="/assets/js/page-Centos7搭建openldap.94b722e9.js"><link rel="prefetch" href="/assets/js/page-Commitmessage和Changelog编写指南.cc2f6e70.js"><link rel="prefetch" href="/assets/js/page-DEVSITUATPETSIMPRDPROD常见环境英文缩写含义.f6bf9d26.js"><link rel="prefetch" href="/assets/js/page-ELK.70b1b2d4.js"><link rel="prefetch" href="/assets/js/page-ElasticStack家族成员及其应用场景.4e625c00.js"><link rel="prefetch" href="/assets/js/page-Elasticsearch分词.590bb19a.js"><link rel="prefetch" href="/assets/js/page-Elasticsearch基础概念.9326e278.js"><link rel="prefetch" href="/assets/js/page-Elasticsearch的安装和简单配置.8691ddf1.js"><link rel="prefetch" href="/assets/js/page-Elasticsearch简介及其发展历史.94f4fd17.js"><link rel="prefetch" href="/assets/js/page-Harbor搭建.4d0d418f.js"><link rel="prefetch" href="/assets/js/page-Harbor高可用搭建.f4101fd2.js"><link rel="prefetch" href="/assets/js/page-JenkinsJob迁移.c0d0be61.js"><link rel="prefetch" href="/assets/js/page-Jenkins关闭和重启的实现方式.9fefb7a3.js"><link rel="prefetch" href="/assets/js/page-Kibana的安装和界面快速浏览.841fee14.js"><link rel="prefetch" href="/assets/js/page-Linux下配置jdk的环境变量.a4bc15a0.js"><link rel="prefetch" href="/assets/js/page-Linux，du、df统计的硬盘使用情况不一致问题.2bda0db4.js"><link rel="prefetch" href="/assets/js/page-Nginx升级加固SSLTLS协议信息泄露漏洞(CVE-2016-2183)和HTTP服务器的缺省banner漏洞.170c8dc3.js"><link rel="prefetch" href="/assets/js/page-PrometheusAlert.19d7c3d5.js"><link rel="prefetch" href="/assets/js/page-Python学习笔记.a68de5bf.js"><link rel="prefetch" href="/assets/js/page-Redis-集群.adaf856c.js"><link rel="prefetch" href="/assets/js/page-RequestBody和QueryDSL简介.f2c8eeb3.js"><link rel="prefetch" href="/assets/js/page-SearchAPI概览.83c461b1.js"><link rel="prefetch" href="/assets/js/page-Summary.3aa71970.js"><link rel="prefetch" href="/assets/js/page-Tomcat错误代号及状态码.4c9d4a42.js"><link rel="prefetch" href="/assets/js/page-URISearch详解.eab40964.js"><link rel="prefetch" href="/assets/js/page-activemq5159集群搭建步骤.a4bb28b2.js"><link rel="prefetch" href="/assets/js/page-centos65下安装python36、pip、ipython.b48822f7.js"><link rel="prefetch" href="/assets/js/page-centos7下搭建shadowsocks.5ea23ecd.js"><link rel="prefetch" href="/assets/js/page-centos7下时区问题.233ff2a6.js"><link rel="prefetch" href="/assets/js/page-centos7安装rabbitmq-379.16d38d14.js"><link rel="prefetch" href="/assets/js/page-centos7安装redis-500主从.a0fb1022.js"><link rel="prefetch" href="/assets/js/page-centos7安装升级ruby.60c26e28.js"><link rel="prefetch" href="/assets/js/page-curl方式执行shell脚本时如何传参.f71ad855.js"><link rel="prefetch" href="/assets/js/page-docker安装rabbitmq集群.12e60c4a.js"><link rel="prefetch" href="/assets/js/page-docker搭建redis集群.5cbe1584.js"><link rel="prefetch" href="/assets/js/page-echo命令.fad68208.js"><link rel="prefetch" href="/assets/js/page-elk借助安装ansible.ddd06d53.js"><link rel="prefetch" href="/assets/js/page-etcsecuritylimitsconf详解与配置.c10cf9a7.js"><link rel="prefetch" href="/assets/js/page-filebeat的安装注意.0fc194e8.js"><link rel="prefetch" href="/assets/js/page-gitlab备份迁移升级集成openldap.f693e678.js"><link rel="prefetch" href="/assets/js/page-git的基本使用.b8558f6e.js"><link rel="prefetch" href="/assets/js/page-hash类型.8c3ebc05.js"><link rel="prefetch" href="/assets/js/page-hexo(next)+github博客的搭建.67dddf0f.js"><link rel="prefetch" href="/assets/js/page-jenkins常见问题.c4862803.js"><link rel="prefetch" href="/assets/js/page-jenkins的安装配置.8a46a723.js"><link rel="prefetch" href="/assets/js/page-kafka212集群搭建步骤.b9fe22aa.js"><link rel="prefetch" href="/assets/js/page-keepalived详解.6376a09a.js"><link rel="prefetch" href="/assets/js/page-linux下如何增加swap交换分区.f2c766b3.js"><link rel="prefetch" href="/assets/js/page-linux简介.4549b749.js"><link rel="prefetch" href="/assets/js/page-list类型.8a1b3498.js"><link rel="prefetch" href="/assets/js/page-logstash安装注意.2be45e18.js"><link rel="prefetch" href="/assets/js/page-mysql最大连接数的改变.0bba2b98.js"><link rel="prefetch" href="/assets/js/page-phpldapadmin操作指导.43774fd3.js"><link rel="prefetch" href="/assets/js/page-pipeline配置java项目.163a1322.js"><link rel="prefetch" href="/assets/js/page-python实际工作中的实例.76941176.js"><link rel="prefetch" href="/assets/js/page-redis-dump方式导入导出数据.6a356ab3.js"><link rel="prefetch" href="/assets/js/page-redis504集群搭建.84626038.js"><link rel="prefetch" href="/assets/js/page-redis面试题.4c89a5ba.js"><link rel="prefetch" href="/assets/js/page-rocketmq集群的搭建.b9704c68.js"><link rel="prefetch" href="/assets/js/page-sed命令详解.f4b16a6d.js"><link rel="prefetch" href="/assets/js/page-set类型.622a2b36.js"><link rel="prefetch" href="/assets/js/page-string类型.8c81e2ee.js"><link rel="prefetch" href="/assets/js/page-tomcat假死现象.252195fe.js"><link rel="prefetch" href="/assets/js/page-tomcat注意事项.b80ab75c.js"><link rel="prefetch" href="/assets/js/page-tomcat简介.55341a61.js"><link rel="prefetch" href="/assets/js/page-zookeeper3414集群搭建步骤.304f83f9.js"><link rel="prefetch" href="/assets/js/page-zset类型.93a92604.js"><link rel="prefetch" href="/assets/js/page-《AdvancedBash-ScriptingGuide》inChinese.04482829.js"><link rel="prefetch" href="/assets/js/page-中文技术文档的写作规范.19e2ce80.js"><link rel="prefetch" href="/assets/js/page-使用JenkinsPipeline自动化构建发布.d210451d.js"><link rel="prefetch" href="/assets/js/page-使用Jenkins扩展共享库进行钉钉消息推送.e0474a4d.js"><link rel="prefetch" href="/assets/js/page-使用docker安装jenkins.f1fee4bd.js"><link rel="prefetch" href="/assets/js/page-使用方法.aee979c9.js"><link rel="prefetch" href="/assets/js/page-倒排索引入门.c4f8ff5d.js"><link rel="prefetch" href="/assets/js/page-写作前.f5803d46.js"><link rel="prefetch" href="/assets/js/page-分布式FastDfs+nginx缓存高可用集群构建.d327b1f1.js"><link rel="prefetch" href="/assets/js/page-创建、复制、移动、删除.7a187d83.js"><link rel="prefetch" href="/assets/js/page-博客主页.3e0eea67.js"><link rel="prefetch" href="/assets/js/page-双圆括号结构.ad4ba8e4.js"><link rel="prefetch" href="/assets/js/page-命名.3acdc469.js"><link rel="prefetch" href="/assets/js/page-在Docker容器中运行Elasticsearch，Kibana和Cerebro.6649486f.js"><link rel="prefetch" href="/assets/js/page-基于docker搭建confluence.303de0cb.js"><link rel="prefetch" href="/assets/js/page-基本权限UGO.76db806e.js"><link rel="prefetch" href="/assets/js/page-基本概念.1bbf2084.js"><link rel="prefetch" href="/assets/js/page-安装python解释器，配置好path变量。.bcc796c7.js"><link rel="prefetch" href="/assets/js/page-容器部署ELK710.eaac35af.js"><link rel="prefetch" href="/assets/js/page-常用知识.82061ffa.js"><link rel="prefetch" href="/assets/js/page-开机集成zabbix和jumpserver脚本.aa7bb7e1.js"><link rel="prefetch" href="/assets/js/page-打包、压缩.83599572.js"><link rel="prefetch" href="/assets/js/page-数据类型.9add61a1.js"><link rel="prefetch" href="/assets/js/page-文档的基本操作CRUP与批量操作.83593188.js"><link rel="prefetch" href="/assets/js/page-日志logrotate.0453540a.js"><link rel="prefetch" href="/assets/js/page-显示当前正在编辑的文件名.a2945260.js"><link rel="prefetch" href="/assets/js/page-服务器端和客户端命令.61ff9110.js"><link rel="prefetch" href="/assets/js/page-查看哪些表被锁住了.cafe44fb.js"><link rel="prefetch" href="/assets/js/page-查看文件内容.a86bbdcf.js"><link rel="prefetch" href="/assets/js/page-查看文件类型.fffccfaf.js"><link rel="prefetch" href="/assets/js/page-查看文件详细属性.e1e8930d.js"><link rel="prefetch" href="/assets/js/page-核心知识点概览.66066bf3.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（21）-find之xargs.22f080ce.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（29）-chown.d28f16f4.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（33）-du.51edeef2.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（35）-diff.820c7f66.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（36）-date.04f6ebeb.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（42）-killall.af7a5b08.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（45）-vmstat.8b108720.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（46）-iostat.036f8493.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（49）-lsof.cc170e00.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（52）-ping.2b465221.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（53）-traceroute.fa702a14.js"><link rel="prefetch" href="/assets/js/page-生产环境中的tomcat配置.cd32981a.js"><link rel="prefetch" href="/assets/js/page-用户管理.820eb7b4.js"><link rel="prefetch" href="/assets/js/page-白天做运维，晚上搞副业赚钱.48b0719e.js"><link rel="prefetch" href="/assets/js/page-第34章陷阱.7423f43c.js"><link rel="prefetch" href="/assets/js/page-第36章杂项.72943f50.js"><link rel="prefetch" href="/assets/js/page-第一章为什么使用shell编程.42c96624.js"><link rel="prefetch" href="/assets/js/page-第一部分初见Shell.e1fc2537.js"><link rel="prefetch" href="/assets/js/page-第七章测试.2138487d.js"><link rel="prefetch" href="/assets/js/page-第三章特殊字符.5bf4d900.js"><link rel="prefetch" href="/assets/js/page-第三部分shell进阶.a9673a83.js"><link rel="prefetch" href="/assets/js/page-第九章换个角度看变量.241632e2.js"><link rel="prefetch" href="/assets/js/page-第二十一章子shell.4bab7f70.js"><link rel="prefetch" href="/assets/js/page-第二十三章进程替换.52d51af8.js"><link rel="prefetch" href="/assets/js/page-第二十二章限制模式的Shell.fc74b6a1.js"><link rel="prefetch" href="/assets/js/page-第二十六章列表结构.25585e4d.js"><link rel="prefetch" href="/assets/js/page-第二章和Sha-Bang（!）一起出发.2a82416b.js"><link rel="prefetch" href="/assets/js/page-第二部分shell基础.f9cb00ce.js"><link rel="prefetch" href="/assets/js/page-第五章引用.d278bb5f.js"><link rel="prefetch" href="/assets/js/page-第五部分高级话题.593435e6.js"><link rel="prefetch" href="/assets/js/page-第八章运算符相关话题.7b1dc763.js"><link rel="prefetch" href="/assets/js/page-第六章退出与退出状态.cba13c59.js"><link rel="prefetch" href="/assets/js/page-第六部分GoogleShell风格指南.3d47e28f.js"><link rel="prefetch" href="/assets/js/page-第十一章循环与分支.578003eb.js"><link rel="prefetch" href="/assets/js/page-第十三章算术扩展.e6c0e04a.js"><link rel="prefetch" href="/assets/js/page-第十二章命令替换.547b72ef.js"><link rel="prefetch" href="/assets/js/page-第十章变量处理.2827f125.js"><link rel="prefetch" href="/assets/js/page-第四章变量与参数.e9158075.js"><link rel="prefetch" href="/assets/js/page-第四部分命令.a7b23384.js"><link rel="prefetch" href="/assets/js/page-管道及IO重定向.d606cd7e.js"><link rel="prefetch" href="/assets/js/page-编程语言的分类.61b0ed29.js"><link rel="prefetch" href="/assets/js/page-网络管理.09f5328b.js"><link rel="prefetch" href="/assets/js/page-聊透监控体系.be13ede9.js"><link rel="prefetch" href="/assets/js/page-计划任务.0fa1736d.js"><link rel="prefetch" href="/assets/js/page-证书相关问题.3e46bece.js"><link rel="prefetch" href="/assets/js/page-调优的目的：.6f4933fa.js"><link rel="prefetch" href="/assets/js/page-软件包管理.20e88d55.js"><link rel="prefetch" href="/assets/js/page-运算符优先级.31aa4f43.js"><link rel="prefetch" href="/assets/js/page-进程管理.f75bc3ab.js"><link rel="prefetch" href="/assets/js/page-通过分析器进行分词.09448c13.js"><link rel="prefetch" href="/assets/js/page-键命令.308812ae.js"><link rel="prefetch" href="/assets/js/page-附录FIO与IO重定向详细介绍.e3966125.js"><link rel="prefetch" href="/assets/js/page-附录TASCII表.3dceba5a.js"><link rel="prefetch" href="/assets/js/page-高可用开源方案KeepalivedVSHeartbeat对比.d1c904d1.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.7998d740.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.e957fda3.js"><link rel="prefetch" href="/assets/js/vendors~reveal.0d670fa7.js"><link rel="prefetch" href="/assets/js/vendors~valine.4e5d56c5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ca69d379.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><button class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><img src="/lufei.jpg" alt="IT外卖小哥" class="logo"> <!----> <span class="site-name can-hide">IT外卖小哥</span></a> <div class="links"><button class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><a href="#" class="default-theme"></a></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  博客主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="推荐教程" class="dropdown-title"><span class="title"><i class="iconfont icon-software"></i>
        推荐教程
      </span> <span class="arrow down"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/code/shell/" class="nav-link"><i class="iconfont icon-shell"></i>
  Shell
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><span class="title"><i class="iconfont icon-code"></i>
        学习笔记
      </span> <span class="arrow down"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>编程语言</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/code/python/" class="nav-link router-link-active active"><i class="iconfont icon-python"></i>
  Python
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>web中间件</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/nginx/" class="nav-link"><i class="iconfont icon-nginx"></i>
  Nginx
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>自动化工具</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/automate/ansible/" class="nav-link"><i class="iconfont icon-ansible"></i>
  Ansible
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>监控工具</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/monitor/zabbix/" class="nav-link"><i class="iconfont icon-zabbix"></i>
  Zabbix
</a></li><li class="dropdown-subitem"><a href="/monitor/elk/" class="nav-link"><i class="iconfont icon-elastic"></i>
  ELK
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>数据库</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mysql/" class="nav-link"><i class="iconfont icon-mysql"></i>
  MySQL
</a></li><li class="dropdown-subitem"><a href="/db/redis/" class="nav-link"><i class="iconfont icon-redis"></i>
  Redis
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Linux</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/basic/" class="nav-link"><i class="iconfont icon-linux"></i>
  Linux
</a></li></ul></li></ul></div></div></nav> <!----> <a rel="noopener noreferrer" href="https://github.com/clay-wangzhi/wiki" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info mobile"><div data-balloon-pos="down" class="blogger hasIntro"><img property="image" alt="Blogger Avatar" src="/lufei.jpg" class="avatar round"> <div property="name" class="name">Clay</div> <meta property="url" content="/intro/"></div> <div class="num-wrapper"><div><div class="num">276</div> <div>Articles</div></div> <div><div class="num">8</div> <div>Category</div></div> <div><div class="num">29</div> <div>Tags</div></div> <div><div class="num">276</div> <div>Timeline</div></div></div> <div class="media-links-wrapper"><a href="mailto:clay_wangzhi@163.com" rel="noopener noreferrer" target="_blank" aria-label="Email" data-balloon-pos="up" class="media-link"><span class="sr-only">Email</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-email"><path d="M0 512a512 512 0 101024 0A512 512 0 100 512z" fill="#1384FF"></path> <path d="M299.372 313.572H722.93c28.945 0 52.61 21.845 52.975 48.787L511.333 500.35 246.76 362.481c.182-27.003 23.666-48.97 52.611-48.97zm-52.671 101.702l-.243 244.121c0 27.186 23.848 49.395 52.914 49.395H722.93c29.127 0 52.975-22.21 52.975-49.395V415.152L517.522 546.71a13.957 13.957 0 01-12.682 0L246.7 415.274z" fill="#FFF"></path></svg></a></div></div> <hr>  <nav class="sidebar-nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  博客主页
</a></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="推荐教程" class="dropdown-title"><span class="title"><i class="iconfont icon-software"></i>
      推荐教程
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/code/shell/" class="nav-link"><i class="iconfont icon-shell"></i>
  Shell
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><span class="title"><i class="iconfont icon-code"></i>
      学习笔记
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>编程语言</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/code/python/" class="nav-link router-link-active active"><i class="iconfont icon-python"></i>
  Python
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>web中间件</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/nginx/" class="nav-link"><i class="iconfont icon-nginx"></i>
  Nginx
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>自动化工具</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/automate/ansible/" class="nav-link"><i class="iconfont icon-ansible"></i>
  Ansible
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>监控工具</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/monitor/zabbix/" class="nav-link"><i class="iconfont icon-zabbix"></i>
  Zabbix
</a></li><li class="dropdown-subitem"><a href="/monitor/elk/" class="nav-link"><i class="iconfont icon-elastic"></i>
  ELK
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>数据库</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mysql/" class="nav-link"><i class="iconfont icon-mysql"></i>
  MySQL
</a></li><li class="dropdown-subitem"><a href="/db/redis/" class="nav-link"><i class="iconfont icon-redis"></i>
  Redis
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Linux</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/basic/" class="nav-link"><i class="iconfont icon-linux"></i>
  Linux
</a></li></ul></li></ul></div></div> <a rel="noopener noreferrer" href="https://github.com/clay-wangzhi/wiki" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/code/python/" aria-current="page" class="sidebar-link">Python 学习笔记</a></li><li><a href="/code/python/python-basic-grammar/" class="sidebar-link">01 Python基础语法</a></li><li><a href="/code/python/python-linear-data-structure/" class="sidebar-link">02 线性数据结构</a></li><li><a href="/code/python/python-ha-tables-analytic-expre/" class="sidebar-link">03 哈希表和解析式</a></li><li><a href="/code/python/python-function/" class="sidebar-link">04 函数</a></li><li><a href="/code/python/python-decorator/" class="sidebar-link">05 装饰器</a></li><li><a href="/code/python/python-dir-file-pro/" class="sidebar-link">06 目录文件处理</a></li><li><a href="/code/python/python-serialize/" class="sidebar-link">07 序列化和反序列化</a></li><li><a href="/code/python/python-exception/" class="sidebar-link">08 异常处理</a></li><li><a href="/code/python/python-oo-package/" class="sidebar-link">09 面向对象-封装</a></li><li><a href="/code/python/python-oo-inher-pol/" class="sidebar-link">10 继承多态和Mixin</a></li><li><a href="/code/python/python-magic/" class="sidebar-link">11 魔术方法</a></li><li><a href="/code/python/python-thread/" class="sidebar-link">12 线程</a></li><li><a href="/code/python/python-thread-sync/" class="sidebar-link">13 线程同步</a></li><li><a href="/code/python/python-gil-multiprocessing/" class="sidebar-link">14 多进程</a></li><li><a href="/code/python/python-tcp-pg/" class="sidebar-link">15 TCP 编程</a></li><li><a href="/code/python/python-socketserver/" class="sidebar-link">16 SocketServer</a></li><li><a href="/code/python/python-io-model/" aria-current="page" class="active sidebar-link">17 IO 模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/python/python-io-model/#重要概念" class="sidebar-link">重要概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/python/python-io-model/#同步、异步" class="sidebar-link heading3">同步、异步</a></li><li class="sidebar-sub-header"><a href="/code/python/python-io-model/#阻塞、非阻塞" class="sidebar-link heading3">阻塞、非阻塞</a></li><li class="sidebar-sub-header"><a href="/code/python/python-io-model/#区别" class="sidebar-link heading3">区别</a></li><li class="sidebar-sub-header"><a href="/code/python/python-io-model/#联系" class="sidebar-link heading3">联系</a></li></ul></li><li class="sidebar-sub-header"><a href="/code/python/python-io-model/#io两个阶段" class="sidebar-link">IO两个阶段</a></li><li class="sidebar-sub-header"><a href="/code/python/python-io-model/#同步-io-模型" class="sidebar-link">同步 IO 模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/python/python-io-model/#阻塞-io" class="sidebar-link heading3">阻塞 IO</a></li><li class="sidebar-sub-header"><a href="/code/python/python-io-model/#非阻塞-io" class="sidebar-link heading3">非阻塞 IO</a></li><li class="sidebar-sub-header"><a href="/code/python/python-io-model/#io多路复用" class="sidebar-link heading3">IO多路复用</a></li><li class="sidebar-sub-header"><a href="/code/python/python-io-model/#信号驱动io" class="sidebar-link heading3">信号驱动IO</a></li></ul></li><li class="sidebar-sub-header"><a href="/code/python/python-io-model/#异步-io" class="sidebar-link">异步 IO</a></li><li class="sidebar-sub-header"><a href="/code/python/python-io-model/#python-中-io多路复用" class="sidebar-link">Python 中 IO多路复用</a></li></ul></li><li><a href="/code/python/python-instance/" class="sidebar-link">python 实际工作中的实例</a></li></ul> </aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/code/python/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">Python 学习笔记</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/code/python/python-io-model/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">17 IO 模型</span></a> <meta property="position" content="2"></li></ol></nav>  <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">17 IO 模型</span></h1> <div class="page-info"><!----> <span aria-label="Writing Date📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">April 3, 2021 23:30</span></span><span aria-label="Author🖊" data-balloon-pos="down"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">Clay</span></span><span aria-label="Page views🔢" data-balloon-pos="down" class="visitor-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon eye-icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 0 0-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z" fill="currentColor"></path></svg> <span id="/code/python/python-io-model/" data-flag-title="17 IO 模型" class="leancloud_visitors"><span class="leancloud-visitors-count">...</span></span></span><span aria-label="Reading Time⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 9 min</span> <meta property="timeRequired" content="PT9M"></span><span aria-label="Words🔠" data-balloon-pos="down" class="words-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon word-icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 0 1 603.43 1.097a512 512 0 0 1 419.474 419.474 73.143 73.143 0 0 1-72.046 85.212H591.36a73.143 73.143 0 0 1-73.143-73.143z" fill="currentColor"></path> <path d="M493.714 566.857h340.297a73.143 73.143 0 0 1 73.143 85.577A457.143 457.143 0 1 1 371.566 117.76a73.143 73.143 0 0 1 85.577 73.143v339.383a36.571 36.571 0 0 0 36.571 36.571z" fill="currentColor"></path></svg> <span>About 2706 words</span> <meta property="wordCount" content="2706"></span><span role="navigation" aria-label="Category🌈" data-balloon-pos="down" class="category-info enable"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon category-icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zm-.854 446.486H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zm446.371-446.486h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zm136.293 813.51H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z" fill="currentColor"></path></svg> <span property="articleSection">Python</span></span><!----></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/code/python/python-io-model/#重要概念" class="anchor-link heading2"><div>重要概念</div></a></li><li class="anchor"><a href="/code/python/python-io-model/#同步、异步" class="anchor-link heading3"><div>同步、异步</div></a></li><li class="anchor"><a href="/code/python/python-io-model/#阻塞、非阻塞" class="anchor-link heading3"><div>阻塞、非阻塞</div></a></li><li class="anchor"><a href="/code/python/python-io-model/#区别" class="anchor-link heading3"><div>区别</div></a></li><li class="anchor"><a href="/code/python/python-io-model/#联系" class="anchor-link heading3"><div>联系</div></a></li><li class="anchor"><a href="/code/python/python-io-model/#io两个阶段" class="anchor-link heading2"><div>IO两个阶段</div></a></li><li class="anchor"><a href="/code/python/python-io-model/#同步-io-模型" class="anchor-link heading2"><div>同步 IO 模型</div></a></li><li class="anchor"><a href="/code/python/python-io-model/#阻塞-io" class="anchor-link heading3"><div>阻塞 IO</div></a></li><li class="anchor"><a href="/code/python/python-io-model/#非阻塞-io" class="anchor-link heading3"><div>非阻塞 IO</div></a></li><li class="anchor"><a href="/code/python/python-io-model/#io多路复用" class="anchor-link heading3"><div>IO多路复用</div></a></li><li class="anchor"><a href="/code/python/python-io-model/#信号驱动io" class="anchor-link heading3"><div>信号驱动IO</div></a></li><li class="anchor"><a href="/code/python/python-io-model/#异步-io" class="anchor-link heading2"><div>异步 IO</div></a></li><li class="anchor"><a href="/code/python/python-io-model/#python-中-io多路复用" class="anchor-link heading2"><div>Python 中 IO多路复用</div></a></li></ul></div></aside></div> <div class="theme-default-content content__default"><h1 id="_17-io-模型"><a href="#_17-io-模型" class="header-anchor">#</a> 17 IO 模型</h1> <h2 id="重要概念"><a href="#重要概念" class="header-anchor">#</a> 重要概念</h2> <h3 id="同步、异步"><a href="#同步、异步" class="header-anchor">#</a> 同步、异步</h3> <p>函数或方法被调用的时候，调用者是否得到<strong>最终结果</strong>的。
直接得到最终结果结果的，就是同步调用；
不直接得到最终结果的，就是异步调用。</p> <h3 id="阻塞、非阻塞"><a href="#阻塞、非阻塞" class="header-anchor">#</a> 阻塞、非阻塞</h3> <p>函数或方法调用的时候，是否立刻返回。
立即返回就是非阻塞调用；
不立即返回就是阻塞调用。</p> <h3 id="区别"><a href="#区别" class="header-anchor">#</a> 区别</h3> <p>同步、异步，与阻塞、非阻塞不相关。
同步、异步强调的是，是否得到（最终的）<strong>结果</strong>；
阻塞、非阻塞强调是时间，是否<strong>等待</strong>。</p> <p>同步与异步区别在于：调用者是否得到了想要的最终结果。
同步就是一直要执行到返回最终结果；
异步就是直接返回了，但是返回的不是最终结果。调用者不能通过这种调用得到结果，以后可以通过被调用者提供的某种方式（被调用者通知调用者、调用者反复查询、回调），来取回最终结果。</p> <p>阻塞与非阻塞的区别在于，调用者是否还能干其他事。
阻塞，调用者就只能干等；
非阻塞，调用者可以先去忙会别的，不用一直等。</p> <h3 id="联系"><a href="#联系" class="header-anchor">#</a> 联系</h3> <p>同步阻塞，我啥事不干，就等你打饭打给我。打到饭是结果，而且我啥事不干一直等，同步加阻塞。
同步非阻塞，我等着你打饭给我，饭没好，我不等，但是我无事可做，反复看饭好了没有。打饭是结果，但是我不一直等。</p> <p>异步阻塞，我要打饭，你说等叫号，并没有返回饭给我，我啥事不干，就干等着饭好了你叫我。例如，取了号什么不干就等叫自己的号。
异步非阻塞，我要打饭，你给我号，你说等叫号，并没有返回饭给我，我去看电视、玩手机，饭打好了叫我。</p> <h2 id="io两个阶段"><a href="#io两个阶段" class="header-anchor">#</a> IO两个阶段</h2> <p>IO过程分两阶段：
1、数据准备阶段。从设备读取数据到内核空间的缓冲区（淘米，把米放饭锅里煮饭）
2、内核空间复制回用户空间进程缓冲区阶段（盛饭，从内核这个饭锅里面把饭装到碗里来）</p> <p>系统调用——read函数、recv函数等</p> <h2 id="同步-io-模型"><a href="#同步-io-模型" class="header-anchor">#</a> 同步 IO 模型</h2> <p>同步IO模型包括 阻塞IO、非阻塞IO、IO多路复用</p> <h3 id="阻塞-io"><a href="#阻塞-io" class="header-anchor">#</a> 阻塞 IO</h3> <p><img src="https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/block_io.png" alt="block_io"></p> <h3 id="非阻塞-io"><a href="#非阻塞-io" class="header-anchor">#</a> 非阻塞 IO</h3> <p>进程调用 recvfrom 操作，如果 IO 设备没有准备好，立即返回 ERROR，进程不阻塞。用户可以再次发起系统调用（可以轮询），如果内核已经准备好，就阻塞，然后复制数据到用户空间。</p> <p>第一阶段数据没有准备好，可以先忙别的，等会再来看看。检查数据是否准备好了的过程是非阻塞的。</p> <p>第二阶段是阻塞的，即内核空间和用户空间之间复制数据是阻塞的。</p> <p>淘米、蒸饭我不阻塞等，反复来询问，一直没有拿到饭。盛饭过程我等着你装好饭，但是要等到盛好饭才算完事，这是同步的，结果就是盛好饭。</p> <p><img src="https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/unblock-io.png" alt="unblock-io"></p> <h3 id="io多路复用"><a href="#io多路复用" class="header-anchor">#</a> IO多路复用</h3> <p>也称 Event-driven IO。</p> <p>所谓 IO 多路复用，就是同时监控多个 IO，有一个准备好了，就不需要等了开始处理，提高了同时处理 IO 的能力。
select几乎所有操作系统平台都支持，poll是对的select的升级。</p> <p>epoll，Linux系统内核2.5+开始支持，对select和poll的增强，在监视的基础上，增加回调机制。BSD、
Mac平台有kqueue，Windows有iocp。</p> <p>以 select 为例，将关注的 IO 操作告诉 select 函数并调用，进程阻塞，内核“监视” select 关注的文件描述符  fd，被关注的任何一个 fd 对应的IO准备好了数据，select 返回。再使用 read 将数据复制到用户进程。</p> <p>select举例：
食堂供应很多菜（众多的IO），你需要吃某三菜一汤，大师傅（操作系统）说要现做，需要你等，好多人都在等菜，谁先好不知道，你只好等待大师傅叫。你的其中一样菜好了，大师傅叫你，说你点的菜有好的了，你得自己遍历找找看哪一样才好了，请服务员把做好的菜打给你。
epoll是有菜准备好了，大师傅喊你去几号窗口直接打菜，不用自己找菜了。</p> <p>一般情况下，select 最多能监听1024个 fd（可以修改），但是由于select采用轮询的方式，当管理的 IO 多了，每次都要遍历全部fd，效率低下。
epoll 没有管理的 fd 的上限，且是回调机制，不需遍历，效率很高。</p> <p><img src="https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/io-more-road.png" alt="io-more-road"></p> <h3 id="信号驱动io"><a href="#信号驱动io" class="header-anchor">#</a> 信号驱动IO</h3> <p>进程在 IO 访问时，先通过 sigaction 系统调用，提交一个信号处理函数，立即返回。进程不阻塞。</p> <p>当内核准备好数据后，产生一个 SIGIO 信号并投递给信号处理函数。可以在此函数中调用 recvfrom 函数
操作数据从内核空间复制到用户空间，这段过程进程阻塞。</p> <h2 id="异步-io"><a href="#异步-io" class="header-anchor">#</a> 异步 IO</h2> <p>进程发起异步 IO 请求，立即返回。内核完成 IO 的两个阶段，内核给进程发一个信号。</p> <p>举例，来打饭，跟大师傅说饭好了叫你，饭菜准备好了，窗口服务员把饭盛好了打电话叫你。两阶段都是异步的。在整个过程中，进程都可以忙别的，等好了才过来。
举例，今天不想出去到饭店吃饭了，点外卖，饭菜在饭店做好了（第一阶段），快递员从饭店送到你家门口（第二阶段）。
Linux 的 aio 的系统调用，内核从版本2.6开始支持</p> <p><img src="https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/io-async.png" alt="io-async"></p> <p>前4个都是同步 IO，因为核心操作 recv 函数调用时，进程阻塞直到拿到最终结果为止。</p> <p>而异步 IO 进程全程不阻塞。</p> <h2 id="python-中-io多路复用"><a href="#python-中-io多路复用" class="header-anchor">#</a> Python 中 IO多路复用</h2> <p>IO多路复用</p> <ul><li>大多数操作系统都支持 select 和 poll</li> <li>Linux 2.5+ 支持 epoll</li> <li>BSD、Mac支持kqueue</li> <li>Solaris 实现了/dev/poll</li> <li>Windows的IOCP</li></ul> <p>Python 的 select 库实现了 select、poll 系统调用，这个基本上操作系统都支持。对Linux内核2.5+支持了 epoll。</p> <p>开发中的选择
1、完全跨平台，使用 select、poll。但是性能较差
2、针对不同操作系统自行选择支持的技术，这样做会提高 IO 处理的性能</p> <p>select 维护一个文件描述符数据结构，单个进程使用有上限，通常是1024，线性扫描这个数据结构。效率低。</p> <p>pool 和 select 的区别是内部数据结构使用链表，没有这个最大限制，但是依然是线性遍历才知道哪个设备就绪了。
epoll 使用事件通知机制，使用回调机制提高效率。
select/poll 还要从内核空间复制消息到用户空间，而 epoll 通过内核空间和用户空间共享一块内存来减少复制。</p> <p><strong>selectors 库</strong></p> <p>3.4 版本提供 selectors 库，高级 IO 复用库。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>类层次结构︰
BaseSelector
+-- SelectSelector  实现select
+-- PollSelector   实现poll
+-- EpollSelector   实现epoll
+-- DevpollSelector  实现devpoll
+-- KqueueSelector  实现kqueue
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>selectors.DefaultSelector 返回当前平台最有效、性能最高的实现。</p> <p>但是，由于没有实现 Windows 下的 IOCP，所以，Windows 下只能退化为 select。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 在selects模块源码最下面有如下代码</span>
<span class="token comment"># Choose the best implementation, roughly:</span>
<span class="token comment">#    epoll|kqueue|devpoll &gt; poll &gt; select.</span>
<span class="token comment"># select() also can't accept a FD &gt; FD_SETSIZE (usually around 1024)</span>
<span class="token keyword">if</span> <span class="token string">'KqueueSelector'</span> <span class="token keyword">in</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    DefaultSelector <span class="token operator">=</span> KqueueSelector
<span class="token keyword">elif</span> <span class="token string">'EpollSelector'</span> <span class="token keyword">in</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    DefaultSelector <span class="token operator">=</span> EpollSelector
<span class="token keyword">elif</span> <span class="token string">'DevpollSelector'</span> <span class="token keyword">in</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    DefaultSelector <span class="token operator">=</span> DevpollSelector
<span class="token keyword">elif</span> <span class="token string">'PollSelector'</span> <span class="token keyword">in</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    DefaultSelector <span class="token operator">=</span> PollSelector
<span class="token keyword">else</span><span class="token punctuation">:</span>
    DefaultSelector <span class="token operator">=</span> SelectSelector
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>事件注册</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">SelectSelector</span><span class="token punctuation">(</span>_BaseSelectorImpl<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Select-based selector.&quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span>fileobj<span class="token punctuation">,</span> events<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> SelectorKey<span class="token punctuation">:</span> <span class="token keyword">pass</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>为 selector 注册一个文件对象，监视它的 IO 事件。返回 <strong>SelectKey</strong> 对象。</li> <li>fileobj 被监视文件对象，例如socket对象</li> <li>events 事件，该文件对象必须等待的事件</li> <li>data 可选的与此文件对象相关联的不透明数据，例如，关联用来存储每个客户端的会话 ID，关联方法。通过这个参数在关注的事件产生后让selector干什么事。</li></ul> <table><thead><tr><th>Event 常量</th> <th>含义</th></tr></thead> <tbody><tr><td>EVENT_READ</td> <td>可读 0b01，内核已经准备好输入设备，可以开始读了</td></tr> <tr><td>EVENT_WRITE</td> <td>可写 0b10，内核准备好了，可以往里写了</td></tr></tbody></table> <p>selectors.SelectorKey 有4个属性：</p> <ol><li>fileobj 注册的文件对象</li> <li>fd 文件描述符</li> <li>events 等待上面的文件描述符的文件对象的事件</li> <li>data 注册时关联的数据</li></ol> <p><strong>练习：IO 多路复用 TCP Server</strong></p> <p>完成一个 TCP Server，能够接受客户端请求并回应客户端消息。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> selectors
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> socket
<span class="token keyword">import</span> time
<span class="token keyword">import</span> logging

FORMAT <span class="token operator">=</span> <span class="token string">&quot;%(asctime)s %(threadName)s %(thread)d %(message)s&quot;</span>
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">,</span> level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span>

<span class="token comment"># 构建本系统最优Selector</span>
selector <span class="token operator">=</span> selectors<span class="token punctuation">.</span>DefaultSelector<span class="token punctuation">(</span><span class="token punctuation">)</span>

sock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># TCP Server</span>
sock<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sock<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token punctuation">)</span>
logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span>sock<span class="token punctuation">)</span>

sock<span class="token punctuation">.</span>setblocking<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># 注意：建议非阻塞</span>

<span class="token comment"># 回调函数，sock的读事件</span>
<span class="token comment"># 形参自定义</span>
<span class="token keyword">def</span> <span class="token function">accept</span><span class="token punctuation">(</span>sock<span class="token punctuation">:</span>socket<span class="token punctuation">.</span>socket<span class="token punctuation">,</span> mask<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;mask: 事件掩码&quot;&quot;&quot;</span>
    conn<span class="token punctuation">,</span> raddr <span class="token operator">=</span> sock<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>setblocking<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># 非阻塞</span>

    logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'new client socket {} in accept.'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 注册sock的被关注事件，返回SelectorKey对象</span>
<span class="token comment"># key记录了fileobj, fileobj的fd, events, data</span>
key <span class="token operator">=</span> selector<span class="token punctuation">.</span>register<span class="token punctuation">(</span>sock<span class="token punctuation">,</span> selectors<span class="token punctuation">.</span>EVENT_READ<span class="token punctuation">,</span> accept<span class="token punctuation">)</span>
logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span>key<span class="token punctuation">)</span>

<span class="token comment"># 开始循环</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># 监听注册的对象的事件，发生被关注事件则返回events</span>
    events <span class="token operator">=</span> selector<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>events<span class="token punctuation">)</span> <span class="token comment"># [(key, mask)]</span>
    <span class="token comment"># 表示那个关注的对象的某事件发生了</span>
    <span class="token keyword">for</span> key<span class="token punctuation">,</span> mask <span class="token keyword">in</span> events<span class="token punctuation">:</span>
        <span class="token comment"># key.data =&gt; accept; key.fileobj =&gt; sock</span>
        callback <span class="token operator">=</span> key<span class="token punctuation">.</span>data
        callback<span class="token punctuation">(</span>key<span class="token punctuation">.</span>fileobj<span class="token punctuation">,</span> mask<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>上面的代码完成了 Server socket 的读事件的监听。注意，select() 方法会阻塞到监控的对象的等待的事件有发生（监听的读或者写就绪）。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> selectors
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> socket
<span class="token keyword">import</span> time
<span class="token keyword">import</span> logging

FORMAT <span class="token operator">=</span> <span class="token string">&quot;%(asctime)s %(threadName)s %(thread)d %(message)s&quot;</span>
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">,</span> level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span>

<span class="token comment"># 构建本系统最优Selector</span>
selector <span class="token operator">=</span> selectors<span class="token punctuation">.</span>DefaultSelector<span class="token punctuation">(</span><span class="token punctuation">)</span>

sock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># TCP Server</span>
sock<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sock<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token punctuation">)</span>
logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span>sock<span class="token punctuation">)</span>

sock<span class="token punctuation">.</span>setblocking<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># 注意：建议非阻塞</span>

<span class="token comment"># 回调函数，sock的读事件</span>
<span class="token comment"># 形参自定义</span>
<span class="token keyword">def</span> <span class="token function">accept</span><span class="token punctuation">(</span>sock<span class="token punctuation">:</span>socket<span class="token punctuation">.</span>socket<span class="token punctuation">,</span> mask<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;mask: 事件掩码&quot;&quot;&quot;</span>
    conn<span class="token punctuation">,</span> raddr <span class="token operator">=</span> sock<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>setblocking<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># 非阻塞</span>

    logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'new client socket {} in accept.'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">)</span>

    key <span class="token operator">=</span> selector<span class="token punctuation">.</span>register<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> selectors<span class="token punctuation">.</span>EVENT_READ<span class="token punctuation">,</span> read<span class="token punctuation">)</span>
    logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span>key<span class="token punctuation">)</span>

<span class="token comment"># 回调函数</span>
<span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>conn<span class="token punctuation">:</span>socket<span class="token punctuation">.</span>socket<span class="token punctuation">,</span> mask<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    msg <span class="token operator">=</span> <span class="token string">&quot;Your msg = {} ~~~&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span>msg<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 注册sock的被关注事件，返回SelectorKey对象</span>
<span class="token comment"># key记录了fileobj, fileobj的fd, events, data</span>
key <span class="token operator">=</span> selector<span class="token punctuation">.</span>register<span class="token punctuation">(</span>sock<span class="token punctuation">,</span> selectors<span class="token punctuation">.</span>EVENT_READ<span class="token punctuation">,</span> accept<span class="token punctuation">)</span>
logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span>key<span class="token punctuation">)</span>

<span class="token comment"># 开始循环</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># 监听注册的对象的事件，发生被关注事件则返回events</span>
    events <span class="token operator">=</span> selector<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>events<span class="token punctuation">)</span> <span class="token comment"># [(key, mask)]</span>
    <span class="token comment"># 表示那个关注的对象的某事件发生了</span>
    <span class="token keyword">for</span> key<span class="token punctuation">,</span> mask <span class="token keyword">in</span> events<span class="token punctuation">:</span>
        <span class="token comment"># key.data =&gt; accept; key.fileobj =&gt; sock</span>
        callback <span class="token operator">=</span> key<span class="token punctuation">.</span>data
        callback<span class="token punctuation">(</span>key<span class="token punctuation">.</span>fileobj<span class="token punctuation">,</span> mask<span class="token punctuation">)</span>





</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/clay-wangzhi/wiki/edit/main/code/python/python-io-model.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">April 6, 2021 11:44</span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/code/python/python-socketserver/" class="prev"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon prev-icon"><path d="M906.783 588.79c-.02 8.499-6.882 15.36-15.38 15.37l-443.7-.01 75.704 191.682c2.52 6.42.482 13.763-5.038 17.91-5.52 4.168-13.138 4.147-18.616-.092L123.228 524.175a15.362 15.362 0 0 1-6-12.165c0-4.782 2.222-9.277 6-12.185L499.753 210.35a15.388 15.388 0 0 1 9.38-3.195c3.236 0 6.502 1.034 9.236 3.103 5.52 4.147 7.578 11.49 5.038 17.91L447.683 419.84l443.72-.01c8.498.01 15.36 6.881 15.36 15.36l.02 153.6z" fill="currentColor"></path></svg>
        16 SocketServer
      </a></span> <span class="next"><a href="/code/python/python-instance/">
        python 实际工作中的实例
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon next-icon"><path d="M906.772 512c0 4.772-2.211 9.267-5.99 12.175L524.257 813.66a15.37 15.37 0 0 1-18.616.092 15.368 15.368 0 0 1-5.038-17.91l75.714-191.672h-443.73c-8.488 0-15.36-6.881-15.36-15.36v-153.6c0-8.489 6.872-15.36 15.36-15.36h443.73l-75.714-191.682a15.358 15.358 0 0 1 5.048-17.91c5.51-4.158 13.128-4.137 18.606.092l376.525 289.485a15.323 15.323 0 0 1 5.99 12.165z" fill="currentColor"></path></svg></a></span></p></div> <div class="comments-wrapper"><div class="valine-wrapper"><div id="valine"></div></div></div> </main> <footer class="footer-wrapper"><div class="media-links-wrapper"><a href="mailto:clay_wangzhi@163.com" rel="noopener noreferrer" target="_blank" aria-label="Email" data-balloon-pos="up" class="media-link"><span class="sr-only">Email</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-email"><path d="M0 512a512 512 0 101024 0A512 512 0 100 512z" fill="#1384FF"></path> <path d="M299.372 313.572H722.93c28.945 0 52.61 21.845 52.975 48.787L511.333 500.35 246.76 362.481c.182-27.003 23.666-48.97 52.611-48.97zm-52.671 101.702l-.243 244.121c0 27.186 23.848 49.395 52.914 49.395H722.93c29.127 0 52.975-22.21 52.975-49.395V415.152L517.522 546.71a13.957 13.957 0 01-12.682 0L246.7 415.274z" fill="#FFF"></path></svg></a></div> <!----> <div class="copyright">Copyright © 2021 Clay</div></footer></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close (Esc)" class="pswp__button pswp__button--close"></button> <button title="Share" class="pswp__button pswp__button--share"></button> <button title="Toggle fullscreen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Previous (arrow left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (arrow right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.8a92dcc3.js" defer></script><script src="/assets/js/layout-Layout.3b564286.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.25725a2a.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.cf79f7df.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout.cbd798c5.js" defer></script><script src="/assets/js/page-17IO模型.519ac500.js" defer></script>
  </body>
</html>
