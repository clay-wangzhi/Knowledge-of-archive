

Nginx实现七层的负载均衡

调度到同一组后端服务器 
网站没按业务/版块拆分，所有后端服务器提供整站代码。
=================================================================================

拓扑结构

							[LB Nginx]
							20.20.20.20
							192.168.1.2

		[httpd]			[httpd]			[httpd]
		192.168.1.3	    192.168.1.4	    192.168.1.5


实施过程
1. nginx
http {
    upstream httpservers {
        server 192.168.1.3:80 weight=1 max_fails=2 fail_timeout=2;
        server 192.168.1.4:80 weight=2 max_fails=2 fail_timeout=2;
        server 192.168.1.5:80 weight=2 max_fails=2 fail_timeout=2;
        server 192.168.1.100:80 backup;
    }

    server {
      		location  / {
                proxy_pass  http://httpservers;
                proxy_set_header X-Real-IP $remote_addr;
      		}
     } 		     		
 }
 
2. Apache LogFormat 可选
LogFormat "%{X-Real-IP}i %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
LogFormat "%h %l %u %t \"%r\" %>s %b" common
LogFormat "%{Referer}i -> %U" referer
LogFormat "%{User-agent}i" agent

3. Nginx LogFormat

=================================================================================














