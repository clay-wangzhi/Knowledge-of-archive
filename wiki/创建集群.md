
- redis的安装包中包含了redis-trib.rb，⽤于创建集群 //ruby
- 接下来的操作在192.168.110.37机器上进⾏
- 将命令复制，这样可以在任何⽬录下调⽤此命令

sudo cp /usr/share/doc/redis-tools/examples/redis-trib.rb /usr/local/bin/

- 安装ruby环境，因为redis-trib.rb是⽤ruby开发的

sudo apt-get install ruby

- 在提示信息处输⼊y，然后回⻋继续安装

![Image](images/60f7a048797db65cdb6bc8d3e3ead27dfae8d6f4.png)

- 运⾏如下命令创建集群

redis-trib.rb create --replicas 1 192.168.110.37:7000 192.168.110.37:7001 192.168.110.37:7002 192.168.110.38:7003 192.168.110.38:7004 192.168.110.38:7005

- 执⾏上⾯这个指令在某些机器上可能会报错,主要原因是由于安装的 ruby 不是最 新版本

![Image](images/0abe73e250d96eca18b707316faabf07329242f7.png)

天朝的防⽕墙导致⽆法下载最新版本,所以需要设置 gem 的源

解决办法如下：

//先查看⾃⼰的 gem 源是什么地址

gem source -l // 如果是https://rubygems.org/ 就需要更换

// 更换指令为

gem sources --add [https://gems.ruby-china.com](https://gems.ruby-china.com/) --remove https://rubygems.org/

// 通过 gem 安装 redis 的相关依赖

sudo gem install redis

// 然后重新执⾏指令

redis-trib.rb create --replicas 1 192.168.110.37:7000 192.168.110.37:7001 192.168.110.37:7002 192.168.110.38:7003 192.168.110.38:7004 192.168.110.38:7005



![Image](images/c37d55d6f5f7fdddab98b60586af597d101a038e.png)

（提示信息输入yes即）

![Image](images/ab23b271bb5040f08ab476f33a4ae7c039f45450.png)

提示完成，集群搭建成功

数据验证

- 根据上图可以看出，当前搭建的主服务器为7000、7001、7003，对应的从服务器是7005、7004、7002
- 在192.168.110.37机器上连接7002，加参数-c表示连接到集群

redis-cli -h 192.168.110.37 -c -p 7002

- ⾃动跳到了7003服务器，并写⼊数据成功

![Image](images/80635cd46763759a670c3fe1907c36808cd9d6ce.png)

- 在7003可以获取数据，如果写入数据又重定向到7001(负载均衡)

![Image](images/2f82ad4792dcc029e4a1a4bb22118a54d9b2a1fe.png)

注意点

- Redis 集群会把数据存在⼀个 master 节点，然后在这个 master 和其对应的salve 之间进⾏数据同步。当读取数据时，也根据⼀致性哈希算法到对应的 master 节 点获取数据。只有当⼀个master 挂掉之后，才会启动⼀个对应的 salve 节点，充 当 master
- 需要注意的是：必须要3个或以上的主节点，否则在创建集群时会失败，并且当存 活的主节点数⼩于总节点数的⼀半时，整个集群就⽆法提供服务了
