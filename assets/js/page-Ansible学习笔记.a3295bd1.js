(window.webpackJsonp=window.webpackJsonp||[]).push([[165],{954:function(l,a,e){"use strict";e.r(a);var s=e(1),_=Object(s.a)({},(function(){var l=this,a=l.$createElement,e=l._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":l.$parent.slotKey}},[e("h1",{attrs:{id:"ansible-学习笔记"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-学习笔记"}},[l._v("#")]),l._v(" Ansible 学习笔记")]),l._v(" "),e("p",[l._v("Hello Ansible~")]),l._v(" "),e("h2",{attrs:{id:"summary"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#summary"}},[l._v("#")]),l._v(" Summary")]),l._v(" "),e("ul",[e("li",[l._v("[1 初识Ansible](Ansible/1 初识Ansible.md)")]),l._v(" "),e("li",[l._v("[2 Ansible Inventory 配置详解](Ansible/2 Ansible Inventory配置详解.md)")]),l._v(" "),e("li",[l._v("[3 Ansible Ad-hoc 命令集](Ansible/3 Ansible Ad-hoc命令集.md)")]),l._v(" "),e("li",[l._v("[3.1 Ansible lineinfile 模块详解](Ansible/3_1_Ansible lineinfile模块详解.md)")]),l._v(" "),e("li",[l._v("[4 Ansible Playbook](Ansible/4 Ansible Playbook.md)\n"),e("ul",[e("li",[l._v("[4.1 Playbook的结构及handler用法](Ansible/4_1_ Playbook的结构及handler用法.md)")]),l._v(" "),e("li",[e("RouterLink",{attrs:{to:"/automate/ansible/Ansible/4_2_Playbook循环语句.html"}},[l._v("4.2 Playbook循环语句")])],1),l._v(" "),e("li",[e("RouterLink",{attrs:{to:"/automate/ansible/Ansible/4_3_Playbook条件语句.html"}},[l._v("4.3 Playbook条件语句")])],1),l._v(" "),e("li",[e("RouterLink",{attrs:{to:"/automate/ansible/Ansible/4_4_Playbook高级用法.html"}},[l._v("4.4 Playbook高级用法")])],1),l._v(" "),e("li",[e("RouterLink",{attrs:{to:"/automate/ansible/Ansible/4_5_Playbook之tags.html"}},[l._v("4.5 Playbook之tags")])],1),l._v(" "),e("li",[e("RouterLink",{attrs:{to:"/automate/ansible/Ansible/4_6_巧用Roles.html"}},[l._v("4.6 巧用Roles")])],1),l._v(" "),e("li",[e("RouterLink",{attrs:{to:"/automate/ansible/Ansible/4_7_文件管理模块及Jinja2过滤器.html"}},[l._v("4.7 文件管理模块及Jinja2过滤器")])],1),l._v(" "),e("li",[e("RouterLink",{attrs:{to:"/automate/ansible/Ansible/4_8_yaml语法.html"}},[l._v("4.8 yaml 语法")])],1)])]),l._v(" "),e("li",[l._v("[5 Ansible变量](Ansible/5 Ansible变量.md)\n"),e("ul",[e("li",[e("RouterLink",{attrs:{to:"/automate/ansible/Ansible/5_1_自定义变量.html"}},[l._v("5.1 自定义变量")])],1),l._v(" "),e("li",[e("RouterLink",{attrs:{to:"/automate/ansible/Ansible/5_2_Fact变量.html"}},[l._v("5.2 Fact变量")])],1),l._v(" "),e("li",[e("RouterLink",{attrs:{to:"/automate/ansible/Ansible/5_3_魔法变量.html"}},[l._v("5.3 魔法变量")])],1),l._v(" "),e("li",[e("RouterLink",{attrs:{to:"/automate/ansible/Ansible/5_4_使用lookup生成变量.html"}},[l._v("5.4 使用lookup生成变量")])],1),l._v(" "),e("li",[e("RouterLink",{attrs:{to:"/automate/ansible/Ansible/5_5_使用vault配置加密.html"}},[l._v("5.5 使用vault配置加密")])],1)])]),l._v(" "),e("li",[l._v("[6 Ansible使用优化](Ansible/6 Ansible使用优化.md)")])]),l._v(" "),e("h2",{attrs:{id:"核心知识点概览"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#核心知识点概览"}},[l._v("#")]),l._v(" 核心知识点概览")]),l._v(" "),e("h3",{attrs:{id:"目前生产中ansible-的使用场景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#目前生产中ansible-的使用场景"}},[l._v("#")]),l._v(" 目前生产中ansible 的使用场景")]),l._v(" "),e("ul",[e("li",[e("p",[e("a",{attrs:{href:"https://github.com/clay-wangzhi/ansible-role-sysinit",target:"_blank",rel:"noopener noreferrer"}},[l._v("系统初始化"),e("OutboundLink")],1)])]),l._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://wiki.clay-wangzhi.com/10-zabbix/10.2-zabbix-jie-zhu-ansible-an-zhuang",target:"_blank",rel:"noopener noreferrer"}},[l._v("安装配置zabbix"),e("OutboundLink")],1)])]),l._v(" "),e("li",[e("p",[e("a",{attrs:{href:""}},[l._v("安装配置elk")])])]),l._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://github.com/clay-wangzhi/ansible-role-tomcat",target:"_blank",rel:"noopener noreferrer"}},[l._v("安装配置tomcat"),e("OutboundLink")],1)])]),l._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://github.com/clay-wangzhi/ansible-role-mysql",target:"_blank",rel:"noopener noreferrer"}},[l._v("安装配置mysql"),e("OutboundLink")],1)])]),l._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://github.com/clay-wangzhi/ansible-role-jenkins",target:"_blank",rel:"noopener noreferrer"}},[l._v("安装配置jenkins"),e("OutboundLink")],1)])]),l._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://github.com/clay-wangzhi/ansible-role-zookeeper",target:"_blank",rel:"noopener noreferrer"}},[l._v("安装配置zookeeper集群"),e("OutboundLink")],1)])]),l._v(" "),e("li",[e("p",[e("a",{attrs:{href:""}},[l._v("项目升级发布")])])]),l._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://github.com/easzlab/kubeasz",target:"_blank",rel:"noopener noreferrer"}},[l._v("安装配置二进制的kubernetes集群"),e("OutboundLink")],1)])])]),l._v(" "),e("h3",{attrs:{id:"ansible-有哪些特性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-有哪些特性"}},[l._v("#")]),l._v(" Ansible 有哪些特性")]),l._v(" "),e("ul",[e("li",[l._v("Agentless，无客户端")]),l._v(" "),e("li",[l._v("Serverless，在服务端无需启动任何服务，只需执行命令即可")]),l._v(" "),e("li",[l._v("默认使用ssh控制各节点")]),l._v(" "),e("li",[l._v("基于模块工作，可以使用任何语言编写模块")]),l._v(" "),e("li",[l._v("使用yaml语言定制playbook")]),l._v(" "),e("li",[l._v("幂等性，多次操作或多次执行不影响结果")])]),l._v(" "),e("h3",{attrs:{id:"ansible-配置文件解析优先级-由高到低依次为"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-配置文件解析优先级-由高到低依次为"}},[l._v("#")]),l._v(" Ansible 配置文件解析优先级，由高到低依次为")]),l._v(" "),e("ol",[e("li",[l._v("ANSIBLE_CONFIG 环境变量指定的配置文件")]),l._v(" "),e("li",[l._v("当前目录下的的ansible.cfg")]),l._v(" "),e("li",[l._v("家目录下的ansible.cfg")]),l._v(" "),e("li",[l._v("/etc/ansible/ansible.cfg")])]),l._v(" "),e("h3",{attrs:{id:"ansible-inventory-知识点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-inventory-知识点"}},[l._v("#")]),l._v(" Ansible inventory 知识点")]),l._v(" "),e("ul",[e("li",[l._v("inventory 主机清单，包含静态inventory和动态inventory")]),l._v(" "),e("li",[l._v("要使用多个inventory的功能，需将inventory指定为文件目录（默认为/etc/ansible/hosts文件）")]),l._v(" "),e("li",[l._v("inventory指定目录时，目录下文件最好不要带有后缀名")]),l._v(" "),e("li",[l._v("Ansible 默认预定义了两个主机组："),e("code",[l._v("all")]),l._v("分组（所有主机）和"),e("code",[l._v("ungrouped")]),l._v("分组（不在分组内的主机）")]),l._v(" "),e("li",[l._v("inventory可以配置单独的变量文件（host_vars和group_vars）")]),l._v(" "),e("li",[l._v("hosts指令，匹配主机，匹配多个用''单引号括起来，用逗号分隔，通配符（*，&, !）,正则匹配，以'~'开头")]),l._v(" "),e("li",[l._v("ansible-inventory命令\n"),e("ul",[e("li",[l._v("树状形式展开主机列表"),e("code",[l._v("ansible-inventory all --graph")])]),l._v(" "),e("li",[l._v("同时带上变量"),e("code",[l._v("ansible-inventory all --graph --vars")])])])]),l._v(" "),e("li",[l._v("通过"),e("code",[l._v("--limit")]),l._v("或"),e("code",[l._v("-l")]),l._v("明确指定主机或组")]),l._v(" "),e("li",[l._v("临时添加节点"),e("code",[l._v("add_host")]),l._v("，临时设置主机组"),e("code",[l._v("group_by")])])]),l._v(" "),e("h3",{attrs:{id:"ansible-hoc-点对点模式-知识点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-hoc-点对点模式-知识点"}},[l._v("#")]),l._v(" Ansible-hoc（点对点模式）知识点")]),l._v(" "),e("ul",[e("li",[e("p",[e("code",[l._v("ansible-doc -l")]),l._v("查看有哪些模块，"),e("code",[l._v("ansible-doc -s moudle")]),l._v("查看某个模块的参数，"),e("code",[l._v("ansible-doc module")]),l._v("查看该模块更详细的信息")])]),l._v(" "),e("li",[e("p",[l._v("命令格式"),e("code",[l._v("ansible 主机或组 -m 模块名 -a '模块参数' ansible参数")])])]),l._v(" "),e("li",[e("p",[l._v("4个命令执行模块的区别：")]),l._v(" "),e("ul",[e("li",[l._v('command模块：该模块通过-a跟上要执行的命令可以直接执行，不过命令里如果有带有如下字符部分则执行不成功 “ "<", ">", "|", "&"')]),l._v(" "),e("li",[l._v("shell 模块：用法基本和command一样，不和command相同，但是支持解析特殊shell符号")]),l._v(" "),e("li",[l._v("raw模块：执行底层shell命令。command和shell模块都是通过目标主机上的python代码启动/bin/sh来执行命令的，raw模块在远程主机上直接启动/bin/sh来执行命令")]),l._v(" "),e("li",[l._v("script模块：在远程主机上执行脚本文件，其原理是先将shell 复制到远程主机，再在远程主机上执行")])])]),l._v(" "),e("li",[e("p",[l._v("常用模块")]),l._v(" "),e("ul",[e("li",[l._v("command")]),l._v(" "),e("li",[l._v("shell")]),l._v(" "),e("li",[l._v("script")]),l._v(" "),e("li",[l._v("ping")]),l._v(" "),e("li",[l._v("file")]),l._v(" "),e("li",[l._v("copy")]),l._v(" "),e("li",[l._v("service")]),l._v(" "),e("li",[l._v("lineinfile")]),l._v(" "),e("li",[l._v("cron")]),l._v(" "),e("li",[l._v("debug")]),l._v(" "),e("li",[l._v("template")])])]),l._v(" "),e("li",[e("p",[l._v("debug 模块")]),l._v(" "),e("p",[l._v("用于输出调试一些数据，模块包含如下选项：")]),l._v(" "),e("ul",[e("li",[l._v('msg：可以输出字符串，可以输出变量的值，变量调用需加"{{}}"')]),l._v(" "),e("li",[l._v("var：只能输出变量的值，变量调用无需加任何东西，只需数据变量名称")])]),l._v(" "),e("blockquote",[e("p",[l._v("注意格式，=号左右没有空格")])])]),l._v(" "),e("li",[e("p",[l._v("lineinfile 模块")]),l._v(" "),e("p",[l._v("lineinfile模块用于在源文件中插入、删除、替换行，和sed命令的功能类似，也支持正则表达式匹配和替换。")]),l._v(" "),e("ul",[e("li",[l._v("path 指定文件")]),l._v(" "),e("li",[l._v("line  行内容")]),l._v(" "),e("li",[l._v("regexp 正则匹配")]),l._v(" "),e("li",[l._v("insertbefore，insertafter 匹配的行前后插入")]),l._v(" "),e("li",[l._v("state 状态")]),l._v(" "),e("li",[l._v("validate 校验文件格式是否正确")]),l._v(" "),e("li",[l._v("regexp和insertXXX结合，regexp参数则充当幂等性判断参数：只有regepx匹配失败时，insertXXX才会插入行")])])])]),l._v(" "),e("h3",{attrs:{id:"ansible-playbook-知识点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-playbook-知识点"}},[l._v("#")]),l._v(" Ansible playbook 知识点")]),l._v(" "),e("ul",[e("li",[e("p",[l._v("playbook、play和task的关系")]),l._v(" "),e("ul",[e("li",[l._v("playbook中可以定义一个或多个play")]),l._v(" "),e("li",[l._v("每个play中可以定义一个或多个task")])])]),l._v(" "),e("li",[e("p",[l._v("可以定义两类特殊的task：pre_tasks和post_tasks")]),l._v(" "),e("ul",[e("li",[l._v("pre_tasks表示执行执行普通任务之前执行的任务列表")]),l._v(" "),e("li",[l._v("post_tasks表示普通任务执行完之后执行的任务列表")])])]),l._v(" "),e("li",[e("p",[l._v("playbook主要有以下四部分构成")]),l._v(" "),e("ul",[e("li",[l._v("Target：用于定义将要执行playbook的远程主机组及远程主机组上的用户，还包括定义通过什么样的方式连接远程主机")]),l._v(" "),e("li",[l._v("Variable：定义playbook运行时需要使用的变量")]),l._v(" "),e("li",[l._v("Task：定义将要在远程主机上执行的任务列表")]),l._v(" "),e("li",[l._v("Handler：定义task执行完成以后需要调用的任务")])])]),l._v(" "),e("li",[e("p",[l._v("常用命令")]),l._v(" "),e("ul",[e("li",[l._v("校验playbook语法 "),e("code",[l._v("ansible-playbook --syntax-check xxx.yml")])]),l._v(" "),e("li",[l._v("测试运行playbook "),e("code",[l._v("ansible-playbook -C xxx.yml")])])])]),l._v(" "),e("li",[e("p",[l._v("循环语句")]),l._v(" "),e("ul",[e("li",[l._v("loop关键字，等价于"),e("code",[l._v("with_list")]),l._v("循环列表")])])]),l._v(" "),e("li",[e("p",[l._v("条件语句")]),l._v(" "),e("ul",[e("li",[l._v("when关键字，block关键字，rescue关键字，always关键字")]),l._v(" "),e("li",[l._v("fail模块，filed_when，ignore_errors，change_when，assert断言模块")]),l._v(" "),e("li",[l._v("any_errors_fatal，max_fail_percentage")])])]),l._v(" "),e("li",[e("p",[l._v("高级用法")]),l._v(" "),e("ul",[e("li",[l._v("本地执行 "),e("code",[l._v("connection: local")])]),l._v(" "),e("li",[l._v("任务委托 "),e("code",[l._v("delegate_to")])]),l._v(" "),e("li",[l._v("任务暂停 "),e("code",[l._v("wait_for")])]),l._v(" "),e("li",[l._v("滚动执行 "),e("code",[l._v("serial")])]),l._v(" "),e("li",[l._v("执行一次 "),e("code",[l._v("run_once")])]),l._v(" "),e("li",[l._v("设置环境变量 "),e("code",[l._v("environment")])]),l._v(" "),e("li",[l._v("交互式提示 "),e("code",[l._v("vars_prompt")])])])]),l._v(" "),e("li",[e("p",[l._v("tag")]),l._v(" "),e("ul",[e("li",[l._v("打tag "),e("code",[l._v("tags:")])]),l._v(" "),e("li",[l._v("指定tag执行 "),e("code",[l._v('--tags "xxx,xxx"')])]),l._v(" "),e("li",[l._v("排除指定的tag执行 "),e("code",[l._v('--skip-tags "xxx,xxx"')])]),l._v(" "),e("li",[l._v("查看所有tag "),e("code",[l._v("--list-tags")])])])]),l._v(" "),e("li",[e("p",[l._v("roles目录结构")]),l._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[l._v("$ ansible-galaxy init first_role\n$ tree first_role/\nfirst_role/            \\\\ 角色名称\n├── defaults           \\\\ 为当前角色设定默认变量时使用此目录，应当包含一个main.yml文件；\n│   └── main.yml        \n├── files              \\\\ 存放有copy或script等模块调用的文件\n├── handlers           \\\\ 此目录应当包含一个main.yml文件，用于定义各角色用到的各handler\n│   └── main.yml\n├── meta               \\\\ 应当包含一个main.yml，用于定义角色的特殊设定及其依赖关系；1.3及以后版本支持\n│   └── main.yml\n├── README.md\n├── tasks              \\\\ 至少包含一个名为main.yml的文件，定义了此角色的任务列表\n│   └── main.yml\n├── templates          \\\\ template模块会自动在此目录中寻找Jinja2模板文件\n├── tests\n│   ├── inventory\n│   └── test.yml\n└── vars              \\\\ 应当包含一个main.yml，用于定义此角色用到的变量\n    └── main.yml\n")])]),l._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[l._v("1")]),e("br"),e("span",{staticClass:"line-number"},[l._v("2")]),e("br"),e("span",{staticClass:"line-number"},[l._v("3")]),e("br"),e("span",{staticClass:"line-number"},[l._v("4")]),e("br"),e("span",{staticClass:"line-number"},[l._v("5")]),e("br"),e("span",{staticClass:"line-number"},[l._v("6")]),e("br"),e("span",{staticClass:"line-number"},[l._v("7")]),e("br"),e("span",{staticClass:"line-number"},[l._v("8")]),e("br"),e("span",{staticClass:"line-number"},[l._v("9")]),e("br"),e("span",{staticClass:"line-number"},[l._v("10")]),e("br"),e("span",{staticClass:"line-number"},[l._v("11")]),e("br"),e("span",{staticClass:"line-number"},[l._v("12")]),e("br"),e("span",{staticClass:"line-number"},[l._v("13")]),e("br"),e("span",{staticClass:"line-number"},[l._v("14")]),e("br"),e("span",{staticClass:"line-number"},[l._v("15")]),e("br"),e("span",{staticClass:"line-number"},[l._v("16")]),e("br"),e("span",{staticClass:"line-number"},[l._v("17")]),e("br"),e("span",{staticClass:"line-number"},[l._v("18")]),e("br"),e("span",{staticClass:"line-number"},[l._v("19")]),e("br")])])]),l._v(" "),e("li",[e("p",[l._v("playbook 调用格式 "),e("code",[l._v('ansible-playbook -i /etc/ansible/xxx.yml /etc/ansbile/playbooks/xx.yml --limit "xxx" -e "key=xxx"')])])]),l._v(" "),e("li",[e("p",[l._v("roles 的任务执行顺序")]),l._v(" "),e("ol",[e("li",[l._v("首先执行meta下的main.yml文件内容     可以设置该role和其它role之前的关联关系。 dependencies")]),l._v(" "),e("li",[l._v("gather_facts任务")]),l._v(" "),e("li",[l._v("pre_tasks指令中的任务")]),l._v(" "),e("li",[l._v("pre_tasks中触发的所有handler")]),l._v(" "),e("li",[l._v("roles指令加载的Role,执行tasks下的main.yml文件内容")]),l._v(" "),e("li",[l._v("tasks指令中的任务")]),l._v(" "),e("li",[l._v("roles和tasks中触发的所有handler, 使用了notify后，会调用 handlers 目录下的main.yml文件")]),l._v(" "),e("li",[l._v("post_tasks指令中的任务")]),l._v(" "),e("li",[l._v("post_tasks中触发的所有handler")])])]),l._v(" "),e("li",[e("p",[l._v("playbook 静态加载和动态加载")]),l._v(" "),e("ul",[e("li",[l._v("roles、include、import_xxx同属一类，它们都是静态加载，都在playbook解析阶段加载文件")]),l._v(" "),e("li",[l._v("include_xxx属于另一类，是动态加载，遇到指令的时候临时去加载文件")]),l._v(" "),e("li",[l._v("要对包含的任务列表进行循环操作，则只能使用"),e("code",[l._v("include_tasks")]),l._v("关键字，不能使用"),e("code",[l._v("import_tasks")]),l._v("关键字，"),e("code",[l._v("import_tasks")]),l._v("并不支持循环操作")]),l._v(" "),e("li",[l._v("使用include_tasks时，这个指令自身占用一个任务，使用import_tasks的时候，这个指令自身没有任务，它所在的任务会在解析playbook的时候被其加载的子任务覆盖")]),l._v(" "),e("li",[l._v("无法使用--list-tags列出include_xxx中的tags，无法使用--list-tasks列出include_xxx中的任务，因为它们都是临时动态加载的")])])]),l._v(" "),e("li",[e("p",[l._v("jinja2")])])]),l._v(" "),e("h3",{attrs:{id:"ansible-变量-知识点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-变量-知识点"}},[l._v("#")]),l._v(" Ansible 变量 知识点")]),l._v(" "),e("ul",[e("li",[e("p",[l._v("变量作用域")]),l._v(" "),e("ul",[e("li",[l._v("全局作用域：Ansible配置文件、环境变量、命令行选项-e,--extra-vars设置的变量都是全局变量")]),l._v(" "),e("li",[l._v("Play作用域：整个Play中都有效的变量，vars_files、vars_prompt、play级别的vars以及Role的变量，它们都是play级别的变量")]),l._v(" "),e("li",[l._v("主机变量：绑定在各主机上的变量，各种方式定义的inventory变量、Facts信息变量(这个就划分在这吧)、set_fact、register、include_vars都是主机变量")]),l._v(" "),e("li",[l._v("任务变量：只在当前任务中生效的变量，task级别的vars定义的变量属于任务变量")]),l._v(" "),e("li",[l._v("block变量：只在当前block内生效，block级别的vars定义的变量属于block变量")]),l._v(" "),e("li",[l._v("预定义特殊变：这些变量由Ansible自身内部维护，有些是全局变量，有些是play变量，有些是主机变量，所以不方便对它们分类")])])]),l._v(" "),e("li",[e("p",[l._v("主机变量")]),l._v(" "),e("ul",[e("li",[e("p",[l._v("内置主机变量"),e("code",[l._v("ansible_host")]),l._v("、"),e("code",[l._v("ansible_port")]),l._v("、"),e("code",[l._v("ansible_user")]),l._v("、"),e("code",[l._v("ansible_password")]),l._v("、"),e("code",[l._v("ansible_connection")]),l._v("等")])]),l._v(" "),e("li",[e("p",[l._v("自定义主机变量，在主机清单中")]),l._v(" "),e("ul",[e("li",[e("p",[l._v("in INI "),e("code",[l._v("hosts1 http_port=80")]),l._v("，")])]),l._v(" "),e("li",[e("p",[l._v("in YAML")]),l._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[l._v("host1:\n  http_port: 80\n")])]),l._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[l._v("1")]),e("br"),e("span",{staticClass:"line-number"},[l._v("2")]),e("br")])])])])]),l._v(" "),e("li",[e("p",[l._v("自定义组变量，在主机清单中")]),l._v(" "),e("ul",[e("li",[e("p",[l._v("in INI")]),l._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[l._v("[atlanta]\nhost1\nhost2\n\n[atlanta:vars]\nntp_server=ntp.aliyun.com\n")])]),l._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[l._v("1")]),e("br"),e("span",{staticClass:"line-number"},[l._v("2")]),e("br"),e("span",{staticClass:"line-number"},[l._v("3")]),e("br"),e("span",{staticClass:"line-number"},[l._v("4")]),e("br"),e("span",{staticClass:"line-number"},[l._v("5")]),e("br"),e("span",{staticClass:"line-number"},[l._v("6")]),e("br")])])]),l._v(" "),e("li",[e("p",[l._v("in YAML")]),l._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[l._v("atlanta:\n  hosts:\n    host1:\n    host2:\n  vars:\n    ntp_server: ntp.aliyun.com\n")])]),l._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[l._v("1")]),e("br"),e("span",{staticClass:"line-number"},[l._v("2")]),e("br"),e("span",{staticClass:"line-number"},[l._v("3")]),e("br"),e("span",{staticClass:"line-number"},[l._v("4")]),e("br"),e("span",{staticClass:"line-number"},[l._v("5")]),e("br"),e("span",{staticClass:"line-number"},[l._v("6")]),e("br")])])])])]),l._v(" "),e("li",[e("p",[l._v("通过"),e("code",[l._v("host_vars")]),l._v("和"),e("code",[l._v("group_vars")]),l._v("目录定义变量，需要说明的是，如果主机组定义的变量与主机冲突，主机变量优先级最高")])])])]),l._v(" "),e("li",[e("p",[l._v("play 变量")]),l._v(" "),e("ul",[e("li",[l._v("通过vars关键字定义")]),l._v(" "),e("li",[l._v("通过vars_files关键字引入变量文件")])])]),l._v(" "),e("li",[e("p",[l._v("注册变量 "),e("code",[l._v("register")])])]),l._v(" "),e("li",[e("p",[l._v("Facts 变量")])]),l._v(" "),e("li",[e("p",[l._v("内置变量/魔法变量")]),l._v(" "),e("ul",[e("li",[l._v("hostvars 所有和主机相关的变量")]),l._v(" "),e("li",[l._v("inventory_hostname 当前正在运行task的主机的主机名")]),l._v(" "),e("li",[l._v("group_names 组名")]),l._v(" "),e("li",[l._v("groups 主机组列表")]),l._v(" "),e("li",[l._v("ansible_play_batch（play_hosts/ansible_play_hosts）当前play所涉及的所有主机列表，但连接失败或执行任务失败的节点不会留在此变量中")]),l._v(" "),e("li",[l._v("inventory_dir 主机清单所在目录")]),l._v(" "),e("li",[l._v("inventory_file 主机清单文件")])])]),l._v(" "),e("li",[e("p",[l._v("lookup 生产变量")]),l._v(" "),e("ul",[e("li",[l._v("语法 "),e("code",[l._v("lookup('<plugin_name>', 'plugin_argument')")])]),l._v(" "),e("li",[l._v("从命令执行结果读取(pipe插件)")]),l._v(" "),e("li",[l._v("从磁盘文件读取(file/fileglob插件)")])])])]),l._v(" "),e("h3",{attrs:{id:"ansible-使用优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-使用优化"}},[l._v("#")]),l._v(" Ansible 使用优化")]),l._v(" "),e("ul",[e("li",[e("p",[l._v("加大forks的值")])]),l._v(" "),e("li",[e("p",[l._v("开启ssh长连接为5天 ，要求ssh为5.6版本，查看版本ssh -v")]),l._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[l._v("# cat /etc/ansible/ansible.cfg\nssh_args = -C -o ControlMaster=auto -o ControlPersist=5d \n")])]),l._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[l._v("1")]),e("br"),e("span",{staticClass:"line-number"},[l._v("2")]),e("br")])])]),l._v(" "),e("li",[e("p",[l._v("Shell层次上的优化：将任务分开执行")])])]),l._v(" "),e("p",[l._v("以下优化，根据实际情况进行修改")]),l._v(" "),e("ul",[e("li",[e("p",[l._v("修改执行策略，改为free")])]),l._v(" "),e("li",[e("p",[l._v("开启pipeling，在不使用sudo的情况下开启pipeling，减少ansible没有传输时的连接数")]),l._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[l._v("修改ansible.cfg中pipelining=False改为True\n")])]),l._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[l._v("1")]),e("br")])])]),l._v(" "),e("li",[e("p",[l._v("修改facts收集行为，"),e("code",[l._v("gather_facts: no")]),l._v(" ，或者添加缓存，注意添加缓存后有坑，比如创建带有时间的文件夹")])]),l._v(" "),e("li",[e("p",[l._v("使Ansible异步执行任务，async和poll指令")])]),l._v(" "),e("li",[e("p",[l._v("第三方策略插件：Mitogen for Ansible")])])]),l._v(" "),e("h3",{attrs:{id:"ansible-常见问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-常见问题"}},[l._v("#")]),l._v(" Ansible 常见问题")]),l._v(" "),e("ul",[e("li",[l._v("server端未安装 sshpass")]),l._v(" "),e("li",[l._v("将host_key_checking设为False，关闭密码检查")])]),l._v(" "),e("h3",{attrs:{id:"yaml-文件知识点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#yaml-文件知识点"}},[l._v("#")]),l._v(" YAML 文件知识点")]),l._v(" "),e("ul",[e("li",[e("p",[l._v("YAML的基本语法规则如下：")]),l._v(" "),e("p",[l._v("(1).使用缩进表示层级关系")]),l._v(" "),e("p",[l._v("(2).缩进时不允许使用Tab键，只允许使用空格")]),l._v(" "),e("p",[l._v("(3).缩进的空格数目不重要，只要相同层级的元素左对齐即可")]),l._v(" "),e("p",[l._v('(4).yaml文件以"---"作为文档的开始，以表明这是一个yaml文件')]),l._v(" "),e("p",[l._v("(5).# 表示注释，从这个字符一直到行尾，都会被解析器忽略")]),l._v(" "),e("p",[l._v("(6).字符串不用加引号，但在可能产生歧义时，需加引号(单双引号皆可)，比如引用变量时")]),l._v(" "),e("p",[l._v("(7).布尔值非常灵活，不分区大小写的true/false、yes/no、on/off、y/n、0和1都允许")])]),l._v(" "),e("li",[e("p",[l._v("YAML支持三种数据结构：")]),l._v(" "),e("p",[l._v("(1).对象：key/value格式，也称为哈希结构、字典结构或关联数组")]),l._v(" "),e("p",[l._v("(2).数组：也称为列表")]),l._v(" "),e("p",[l._v("(3).标量(scalars)：单个值")])])])])}),[],!1,null,null,null);a.default=_.exports}}]);